<app-header/>
<div class="p-6 max-w-4xl mx-auto">
  
  <div class="flex flex-row gap-8 items-center mb-3">
    <button mat-icon-button color="primary" (click)="navigateBackHome()" aria-label="View">
      <mat-icon>keyboard_backspace</mat-icon>
    </button>
    <h2 class="text-2xl font-medium">{{ isEditMode ? 'Actualizar' : 'Crear' }}</h2>
  </div>
  
  <form [formGroup]="personForm" (ngSubmit)="onSave()" class="space-y-6">
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      
      <mat-form-field appearance="outline" class="search-input w-full">
        <mat-label class="">NIT</mat-label>
        <input matInput formControlName="nit" required>
        <mat-error *ngIf="personForm.get('nit')?.hasError('required')">El NIT es obligatorio.</mat-error>
        <mat-error *ngIf="personForm.get('nit')?.hasError('pattern')">Formato de NIT invalido.</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Nombre</mat-label>
        <input matInput formControlName="name" required>
        <mat-error *ngIf="personForm.get('name')?.hasError('required')">El Nombre es obligatorio.</mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Dirección</mat-label>
        <input matInput formControlName="address" required>
        <mat-error *ngIf="personForm.get('address')?.hasError('required')">La Dirección es obligatoria.</mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Teléfono</mat-label>
        <input matInput formControlName="phone_number" required>
        <mat-error *ngIf="personForm.get('phone_number')?.hasError('required')">El Telefono es obligatorio.</mat-error>
        <mat-error *ngIf="personForm.get('phone_number')?.hasError('pattern')">Formato de Telwfono invalido.</mat-error>
      </mat-form-field>
    </div>
    
    <mat-divider></mat-divider>

    <div class="flex justify-between items-center my-4">
      <h2 class="text-xl font-semibold mt-6 mb-4 text-gray-700">Credenciales Educativas</h2>
      <button 
        mat-raised-button 
        color="accent" 
        type="button" 
        (click)="openCertificationDialog()">
        <mat-icon>add</mat-icon>
        Certificacion
      </button>
    </div>

    <div class="mat-elevation-z2">
      <table mat-table [dataSource]="certificationsDataSource" class="w-full">
        
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef> Tipo </th>
          <td mat-cell *matCellDef="let cert"> {{ cert.type | titlecase }} </td>
        </ng-container>

        <ng-container matColumnDef="organization">
          <th mat-header-cell *matHeaderCellDef> Organizacinn </th>
          <td mat-cell *matCellDef="let cert"> {{ cert.organization }} </td>
        </ng-container>

        <ng-container matColumnDef="acquired_credential">
          <th mat-header-cell *matHeaderCellDef> Titulo </th>
          <td mat-cell *matCellDef="let cert"> {{ cert.acquired_credential }} </td>
        </ng-container>

        <ng-container matColumnDef="year">
          <th mat-header-cell *matHeaderCellDef> Año </th>
          <td mat-cell *matCellDef="let cert"> {{ cert.year }} </td>
        </ng-container>
        
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Acciones </th>
          <td mat-cell *matCellDef="let cert">
            <button mat-icon-button color="primary" type="button" (click)="openCertificationDialog(cert)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" type="button" (click)="deleteCertification(cert)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedCertColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedCertColumns;"></tr>
        
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell text-center py-4" colspan="5">Aún no hay certificaciones añadidas.</td>
        </tr>
      </table>
    </div>
    
    <mat-divider></mat-divider>

    <div class="flex justify-end space-x-4 pt-4">
      <button 
        mat-button 
        type="button" 
        (click)="onCancel()">
        Cancelar
      </button>
      
      <button 
        mat-raised-button 
        color="primary" 
        type="submit" 
        [disabled]="personForm.invalid">
        <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
        {{ isEditMode ? 'Guardar Cambios' : 'Crear' }}
      </button>
    </div>
  </form>
</div>